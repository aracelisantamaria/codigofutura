# üöÄ Token BDB - Buen D√≠a Builder

Gu√≠a completa para crear, compilar y deployar un token fungible en Stellar Soroban usando Rust.

---

## üìã Tabla de Contenidos

- [Pre-requisitos](#-pre-requisitos)
- [Conceptos Fundamentales](#-conceptos-fundamentales)
- [Configuraci√≥n del Proyecto](#-configuraci√≥n-del-proyecto)
- [Compilaci√≥n](#-compilaci√≥n)
- [Testing](#-testing)
- [Deploy a Testnet](#-deploy-a-testnet)
- [Integraci√≥n con Frontend](#-integraci√≥n-con-frontend)
- [Glosario](#-glosario)
- [Tips y Troubleshooting](#-tips-y-troubleshooting)

---

## üéØ Pre-requisitos

### Software Necesario

```bash
# Verificar instalaciones
rustc --version        # Debe ser 1.74.0+
cargo --version        # Debe ser 1.74.0+
stellar --version      # Debe ser 21.0.0+
node --version         # Debe ser v22.0.0+
```

### Conocimientos T√©cnicos Requeridos

#### Option<T> y Result<T, E>

- **`Option<T>`**: Representa un valor que puede o no existir
  - **¬øCu√°ndo usarlo?** Cuando algo leg√≠timamente puede no existir y eso no es un error
  
- **`Result<T, E>`**: Representa una operaci√≥n que puede tener √©xito o fallar
  - **¬øCu√°ndo usarlo?** Cuando una operaci√≥n puede fallar y necesitas informaci√≥n sobre por qu√© fall√≥

#### Traits: "Contratos de Comportamiento"

Un trait es como un contrato que define qu√© funciones debe tener un tipo (similar a interfaces en otros lenguajes).

**Beneficios:**
- ‚úÖ Garantiza que tu token tiene todas las funciones requeridas
- ‚úÖ Compatible con wallets, DEXs, etc.
- ‚úÖ Documentaci√≥n clara de la interfaz

#### Ownership y Borrowing

**Las 3 reglas de oro del Ownership:**
1. Cada valor tiene un √∫nico due√±o
2. Solo puede haber un due√±o a la vez
3. Cuando el due√±o sale del scope, el valor se destruye

**Borrowing (Pr√©stamo):**
- **Inmutable (`&T`)**: Puedes leer, pero no modificar
- **Mutable (`&mut T`)**: Puedes leer y modificar

---

## üí° Conceptos Fundamentales

### ¬øQu√© es un Token en Blockchain?

Un token es una versi√≥n digital de algo con valor que vive dentro de una blockchain.

- **Fungible**: Tokens id√©nticos e intercambiables entre s√≠ (como dinero)
- Es como una ficha o moneda virtual que no depende de un banco, sino del c√≥digo

### Storage en Soroban

#### Instance Storage
- Para metadatos del contrato (admin, name, symbol)
- Compartido entre todas las invocaciones
- M√°s barato

#### Persistent Storage
- Para datos de usuarios (balances, allowances)
- Espec√≠fico por key
- Requiere gesti√≥n de TTL

### Funciones Core de un Token

1. **`initialize()`** - Configurar el token (nombre, s√≠mbolo, decimales)
2. **`mint()`** - Crear nuevos tokens (solo admin, aumenta supply total)
3. **`burn()`** - Destruir tokens permanentemente (reduce supply total)
4. **`transfer()`** - Enviar tokens entre cuentas
5. **`approve()`** - Autorizar a otro address a gastar tus tokens
6. **`balance()`** - Consultar saldo de una cuenta
7. **`allowance()`** - Ver cu√°nto puede gastar un address autorizado

---

## üî® Configuraci√≥n del Proyecto

### Paso 1: Crear el Proyecto (5 min)

```bash
# Crear carpeta del proyecto
mkdir token_bdb
cd token_bdb

# Inicializar proyecto Rust
cargo init --lib
```

üí° `cargo init --lib` crea un proyecto de librer√≠a (necesario para contratos Soroban)

### Paso 2: Configurar Target WASM

```bash
# Instalar target wasm32 (solo la primera vez)
rustup target add wasm32-unknown-unknown
```

---

## üèóÔ∏è Compilaci√≥n

### Build en Modo Desarrollo (Debug)

```bash
cargo build
```

**Caracter√≠sticas:**
- ‚úÖ Compilaci√≥n r√°pida
- ‚úÖ Incluye informaci√≥n de debug
- ‚ùå No optimizado (m√°s lento en ejecuci√≥n)
- üìÅ Output: `target/debug/`

**Cu√°ndo usarlo:** Durante desarrollo para probar cambios r√°pido

### Build en Modo Release (Producci√≥n)

```bash
cargo build --release
```

**Caracter√≠sticas:**
- ‚è∞ Compilaci√≥n lenta (m√°s optimizaciones)
- ‚úÖ C√≥digo altamente optimizado
- ‚úÖ Ejecutable m√°s r√°pido
- ‚ùå Sin informaci√≥n de debug
- üìÅ Output: `target/release/`

**Cu√°ndo usarlo:** Para producci√≥n, benchmarks, deploy

### Build para WebAssembly (Soroban)

```bash
# M√©todo recomendado
stellar contract build

# O manualmente
cargo build --target wasm32-unknown-unknown --release
```

üìÅ Output: `target/wasm32-unknown-unknown/release/`

### Optimizar WASM (Recomendado)

```bash
# Instalar wasm-opt
cargo install wasm-opt

# Optimizar el WASM
wasm-opt -Oz \
  target/wasm32-unknown-unknown/release/token_bdb.wasm \
  -o target/wasm32-unknown-unknown/release/token_bdb_optimized.wasm
```

**Beneficios:**
- Reduce el tama√±o 30-50%
- Ahorra costos de storage en blockchain
- Mantiene toda la funcionalidad

---

## üß™ Testing

### Ejecutar Todos los Tests

```bash
cargo test
```

### Ejecutar Tests Espec√≠ficos

```bash
# Test de inicializaci√≥n
cargo test test_initialize

# Test de mint
cargo test test_mint_and_balance -- --nocapture

# Test de transferencias
cargo test test_transfer -- --nocapture

# Test de validaciones
cargo test test_initialize_empty_name_fails
cargo test test_initialize_empty_symbol_fails
```

### Tests con Output Detallado

```bash
cargo test -- --nocapture
```

### Tests Autom√°ticos (Watch Mode)

```bash
# Instalar cargo-watch
cargo install cargo-watch

# Ejecutar tests autom√°ticamente al cambiar archivos
cargo watch -x test
```

### Code Coverage (Solo Linux)

```bash
# Instalar cargo-tarpaulin
cargo install cargo-tarpaulin

# Generar reporte de cobertura
cargo tarpaulin --out Html
```

---

## üöÄ Deploy a Testnet

### Paso 1: Configurar Cuenta

```bash
# Generar nueva identidad
stellar keys generate --name alice --network testnet

# Listar todas las claves
stellar keys ls

# Ver direcci√≥n p√∫blica
stellar keys address alice

# Fondear con XLM gratis
stellar keys fund alice --network testnet

# O usar curl
publicKey=$(stellar keys address alice)
curl "https://friendbot.stellar.org?addr=$publicKey"
```

### Paso 2: Deploy del Contrato

```bash
stellar contract deploy \
  --wasm target/wasm32-unknown-unknown/release/token_bdb.wasm \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org
```

**Guarda el Contract ID que devuelve:**

```bash
CONTRACT_ID=CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### Paso 3: Inicializar el Token

```bash
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  initialize \
  --admin GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX \
  --name "Buen Dia Builders Token" \
  --symbol "BDB" \
  --decimals 7
```

### Paso 4: Verificar Inicializaci√≥n

```bash
# Ver nombre
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  name

# Ver s√≠mbolo
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  symbol

# Ver decimales
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  decimals
```

### Paso 5: Mintear Tokens

```bash
# Mintear 1,000,000 tokens (con 7 decimales)
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  mint \
  --to GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX \
  --amount 10000000000000
```

üí° **Nota:** `10000000000000 = 1,000,000` tokens (con 7 decimales)

### Paso 6: Verificar Balance

```bash
# Ver balance de una cuenta
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  balance \
  --account GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

# Ver supply total
stellar contract invoke \
  --id $CONTRACT_ID \
  --source alice \
  --network testnet \
  --rpc-url https://soroban-testnet.stellar.org \
  -- \
  total_supply
```

---

## üåê Integraci√≥n con Frontend

### Paso 1: Crear Proyecto Scaffold

```bash
# Salir de la carpeta del contrato
cd ..

# Crear proyecto frontend
npx create-stellar-app@latest mi-token-bdb
cd mi-token-bdb
```

### Paso 2: Copiar tu Contrato

```bash
# Copiar contrato al proyecto scaffold
cp -r ~/ruta/a/token-bdb ./contracts/buen_dia_token
```

### Paso 3: Configurar Variables de Entorno

Crear archivo `.env`:

```bash
# ===================================
# CONFIGURACI√ìN DE RED
# ===================================

VITE_STELLAR_NETWORK=testnet
VITE_STELLAR_RPC_URL=https://soroban-testnet.stellar.org

# ===================================
# TU CONTRATO BDB
# ===================================

VITE_BDB_CONTRACT_ID=CXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### Paso 4: Instalar Dependencias

```bash
# Dependencias base
npm install

# Verificar dependencias Stellar
npm list @stellar/freighter-api @stellar/stellar-sdk
```

### Paso 5: Generar Cliente TypeScript

```bash
npm run build:contracts
```

Este comando:
- Lee tu contrato WASM
- Analiza todas las funciones p√∫blicas
- Genera autom√°ticamente c√≥digo TypeScript
- Crea tipos seguros para interactuar con el contrato

### Paso 6: Instalar Freighter Wallet

1. Instala la extensi√≥n [Freighter](https://freighter.app) en Chrome/Firefox
2. Crea o importa una cuenta
3. Cambia a **Testnet**
4. Fondea tu cuenta con XLM

### Paso 7: Ejecutar el Frontend

```bash
npm run dev
```

Abre `http://localhost:5173/` en tu navegador

---

## üìö Glosario

| T√©rmino | Descripci√≥n |
|---------|-------------|
| **WASM** | WebAssembly - Tu c√≥digo Rust compilado en formato ejecutable por blockchain |
| **Contract ID** | Identificador √∫nico del contrato (empieza con "C") |
| **Network Passphrase** | Define si est√°s en Testnet o Mainnet |
| **Testnet** | Blockchain de pr√°ctica (XLM gratis, sin valor monetario) |
| **Public Key** | Tu direcci√≥n p√∫blica (empieza con "G") |
| **Secret Key** | Tu contrase√±a privada (empieza con "S") - ¬°NUNCA la compartas! |
| **XLM** | Token nativo de Stellar (para pagar fees) |
| **TTL** | Time To Live - Tiempo que los datos persisten en storage |

---

## üí° Tips y Troubleshooting

### Tips Clave

> "En blockchain, el c√≥digo ES la ley. Una vez deployado, no hay Ctrl+Z"

> "Siempre usa `Result<T, Error>` en lugar de `panic!` para production"

> "Extender TTL es cr√≠tico en testnet para que tus datos no expiren"

> "Los tests no son opcionales - son tu red de seguridad"

### Errores Comunes

#### Error: "could not find `Cargo.toml`"

**Soluci√≥n:** Aseg√∫rate de ejecutar los comandos desde la carpeta del proyecto

```bash
cd token_bdb
cargo build --target wasm32-unknown-unknown --release
```

#### Error: Certificados SSL en Windows

Si ves errores SSL/TLS:

```bash
# Descargar certificados manualmente
curl -O https://curl.se/ca/cacert.pem
set SSL_CERT_FILE=cacert.pem
```

#### Error: "wasm file not found"

Verifica el nombre en `Cargo.toml`:

```bash
cat Cargo.toml | grep "name ="
```

El archivo WASM se llamar√° `[name].wasm`

#### Build limpio

Si tienes problemas de compilaci√≥n:

```bash
cargo clean
stellar contract build
```

---

## üéì Lo que Aprendiste

Al completar este proyecto, has logrado:

- ‚úÖ Configurar un proyecto Soroban desde cero
- ‚úÖ Compilar un smart contract a WASM
- ‚úÖ Ejecutar tests unitarios
- ‚úÖ Entender el flujo completo de desarrollo
- ‚úÖ Deployar en blockchain (testnet)
- ‚úÖ Integrar con un frontend React
- ‚úÖ Conectar wallets (Freighter)
- ‚úÖ Interactuar con contratos desde el navegador

---

## üîó Enlaces √ötiles

- [Stellar Docs](https://docs.stellar.org)
- [Soroban Docs](https://soroban.stellar.org)
- [Freighter Wallet](https://freighter.app)
- [Stellar Expert (Explorador)](https://stellar.expert)
- [Friendbot (XLM Testnet)](https://laboratory.stellar.org/#account-creator?network=test)

---

## üìù Licencia

Este proyecto es de c√≥digo abierto .

---

**¬°Felicitaciones por completar tu primer token en Stellar! üéâ**
